#summary Предложения по развитию системы сборки.

<wiki:gadget0 url="http://embox.googlecode.com/svn/wiki/gadgets/userbox-feature-proposal.xml" width="640" height="100" border="0"/>
<wiki:toc max_depth="2"/> 

= Введение =
На этой странице результаты мозгового штурма на тему развития системы сборки EMBuild, просто идеи и мысли, а также план работ в этом направлении.

= Проблемы и возможные пути решения =
Текущая версия системы сборки больше не удовлетворяет нуждам проекта:
 * Разбухание некоторых Makefile'ов, например в `src/kernel`
 * Теряется видение структуры проекта
 * Нет гибкости в задании зависимостей для модулей

Для лучшего понимания назревших проблем предлагаю рассмотреть часть файла [http://code.google.com/p/embox/source/browse/trunk/embox/src/kernel/Makefile?r=1142 src/kernel/Makefile]. Он иллюстрирует большинство существующих сейчас недостатков. Этот пример и попробуем постепенно довести до ума.
{{{
$_PACKAGE   := core.kernel

$_CPPFLAGS  += -D__KERNEL__

$_LDFLAGS   += $($_SELFDIR)/nosys.lds

$(IMAGE): $($_SELFDIR)/nosys.lds

$_MODS_CORE += main
$_MODS      += irq softirq

$_SRCS-main += main.c
$_SRCS-main += init.c
$_SRCS-main += nosys.c

$_DEPS-main += embox.hal.arch
$_DEPS-main += irq

ifdef CONFIG_IRQ
 $_SRCS-irq += irq.c
 $_DEPS-irq += embox.hal.interrupt
 $_DEPS-irq += softirq
endif
ifdef CONFIG_SOFTIRQ
 $_SRCS-softirq += softirq.c
endif
}}}

== Структура Makefile'ов ==
=== Проблема ===
Итак, смотрим [http://code.google.com/p/embox/source/browse/trunk/embox/src/kernel/Makefile?r=1142 src/kernel/Makefile]. Видим кучу определений переменных, описывающих свойства различных модулей. В одном месте:
 * Текущий пакет
{{{
$_PACKAGE   := core.kernel
}}}
 * Флаги компиляции
  * Для текущего пакета
{{{
$_CPPFLAGS  += -D__KERNEL__
}}}
  * И для всего образа
{{{
$_LDFLAGS   += $($_SELFDIR)/nosys.lds
}}}
 * Определение модулей
{{{
$_MODS_CORE += main
$_MODS      += irq softirq
}}}
  * Их исходников
{{{
$_SRCS-main += main.c
$_SRCS-main += init.c
$_SRCS-main += nosys.c

ifdef CONFIG_IRQ
 $_SRCS-irq += irq.c
endif
ifdef CONFIG_SOFTIRQ
 $_SRCS-softirq += softirq.c
endif
}}}
  * И зависимостей
{{{
$_DEPS-main += embox.hal.arch
$_DEPS-main += irq
