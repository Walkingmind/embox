Механизм [TheoryVirtualMemory виртуальной памяти] используется для предоставления приложениям 
линейного адресного пространства, изолированного от адресных
пространств других приложений.

Общая схема работы заключается в следующем. При каждом обращении процессора к памяти, 
адрес обращения (виртуальный адрес) заменяется другим адресом, указывающий на данные
в физической памяти.

Для обеспечения приемлемой скорости работы, преобразованием виртуального адреса в физический 
занимается специальное устройство, менеджер памяти (MMU).

Полная поддержка виртуальной памяти осуществляется на нескольких уровнях ОС.

== Схема работы ==

http://embox.googlecode.com/svn/wiki/images/VirtualMemory/arch.png

=== Приложение ===

Приложение имеет линейное адресное пространство памяти. Организация памяти
полностью лежит на приложении. 

=== Ядро ===

Ядро поддерживает иллюзию непрерывного адресного пространства у приложения 
посредством механизма виртуальной памяти. Настройка заключается в установке 
первоначальных таблиц отображений, установке обработчика исключения 
виртуальной памяти. Исключение возникает в случае, если приложение пытается
совершить действия, неразрешенные правами доступа (например, взять на исполнение
инструкцию из области данных), тогда происходит завершение приложения с сообщением
об ошибке.
Прерывание так же возникает если не существует отображения данного
виртуального адреса, тогда, если виртуальный адрес является допустимым,
ядро обращается к менеджеру памяти для поиска свободной физической области, после ядро создаёт новое
отображение. Если область не найдена, то проводится последовательность
действий: поиск наименее важной области (по некоторому критерию) физической памяти, выгрузка
её во внешнюю память, использование области как свободной. Если же невозможно произвести выгрузку
(политика работы ядра, недостаток места во внешней памяти, и так далее), то происходит завершение 
работы приложения с сообщением об ошибке.

=== HAL ===

Ядро использует HAL для управление контроллером памяти и установкой прерываний.
HAL предоставляет базовые примитивы для работы с контроллером памяти для привилегированного
режима:
включение/выключение виртуального режима, осуществляется установкой флага в слове состояния процессора;
создание отображения. Отображение задаётся специальной записью в таблице отображения. Таблица может быть
линейной или древовидной (всё отображение задаётся таблицей, где каждый элемент либо запись об отображении,
либо ссылка на таблицу более глубокого уровня, задающую отображение для меньшей области памяти). Запись
отображения содержит в себе информацию об отображаемом виртуальном адресе, связанном с ним физическом адресе,
права доступа к физическому адресу (исполнение, запись, кэширование), флаги о произведённых отображениях (факт
об использовании данного отображения, произведённой при этом записи, и так далее).
