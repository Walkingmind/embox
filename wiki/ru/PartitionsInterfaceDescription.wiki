#summary Описание интерфейса разделов

<wiki:toc max_depth="2" />

= Введение = 

На странице описан интерфейс разделов, используемый для хранения информации на дисках. Похожий принцип можно реализовывать и во встроенных системах. Такие системы как извесно характерны отсуствием жестких дисков, к тому же в некоторых системах код выполняется прямо из flash памяти (например в [LegoMildstorm Lego Mindstorm]).
В любом случае система начинает выполнять стартовый код с какого-то постоянного носителя, данный код иногда называется загрузчиком первого уровня, он может например считать таблицу разделов и передать управление нужному загрузчику второго уровня, который в свою очередь передаст управление уже основной ОС.

== Cтруктура диска ==

Диски делятся на разделы с независимой файловой систомой на каждом разделе. Общая структура диска представлена на схеме.

|| MBR || Раздел 1 || Раздел 2 || Раздел 3 ||

Во встроенных системах стартовый код часто находится на том же носителе, где и оснавная программа. То есть структура устройства хранения выглядит следующим образом:
|| boot_code || STORAGE_INFO || OTHER_SECTION ||
STORAGE_INFO может представлять из себя структуру приведенную выше.

=== Master Boot Record ===

Раздел 0 называется * главной загрузочной записью (MBR, Master Boot Record)* и используется для загрузки компьютера. Начало этой записи - набор ассемблерных инструкций, выполняемых при загрузке (загрузчик первого уровня). В конце главной загрузочной записи содержится таблица разделов, в которой хранятся начальные и конечные адреса каждого остального раздела (таким образом, в ней хранится информация о разделении оставшегося дискового пространства на разделы). Один из разделов в этой таблице помечен как активный. Задача загрузчика первого уровня - найти активный раздел и передать управление на его начальный адрес.

=== Таблица разделов ===

В MBR под таблицу разделов отведено 64 байта. Каждая запись о разделе занимает 16 байт. Таким образом, в таблице может содержаться только 4 записи. В реальности это означает, что любой диск может быть разбит не более чем на четыре раздела. В современных системах это ограничение обходится с помощью введения понятия * дополнительного раздела *, но это пока не важно. Дополнительная информация о структуре MBR и таблице разделов будет позже.

== Структура раздела ==

Все остальные разделы имеют примерно общую структуру, представленную на схеме ниже:

|| Загрузочный блок || Суперблок || Информация о свободном пространстве || Дополнительная информация || Файлы и каталоги ||

Начало любого раздела - загрузочный блок. Он обязательно присутствует. Загрузочный блок содержит в себе некий исполняемый код (загрузчик второго уровня), который загружает операционную систему, содержащуюся в этом разделе. Даже если раздел не содержит ОС, загрузочный блок все равно присутствует для единообразия.

В остальном строение диска может меняться от системы к системе, схема представленная на картинке не более чем некая рекомендация о том, что обычно там содержится.

Суперблок содержит ключевые параметры файловой системы и считывается в память при загрузке компьютера при первом обращении к файловой системе. Типичная содержащаяся в нем информация - "магическое число", идентифицирующее системные файлы; количество блоков в файловой системе и прочее.

Далее располагается информация о свободных блоках файловой системы (например, в виде битового массива или списка указателей).

Далее обычно располагается дополнительная информация об ФС, зависящая от типа файловой системы. Например, информация о файлах, корневой каталог.

Далее располагаются собственно файлы и каталоги, содержащие полезную информацию.
