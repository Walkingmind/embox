HEADERS_BUILD := \
  $(patsubst %,$(OBJ_DIR)/mods/%.h,$(subst .,/,$(APIS_BUILD)))
__header_mod = \
  $(subst /,.,$(patsubst $(abspath $(OBJ_DIR))/mods/%.h,%,$(abspath $@)))

__header_gen = \
  $(subst $(\n),\n,$(call __header_template,$(__header_mod)))
# 1. Header mod
define __header_template
/* Autogenerated file. Do not edit. */

#ifndef __MOD_HEADER__$(subst .,__,$1)
#define __MOD_HEADER__$(subst .,__,$1)
$(foreach impl,$(call symbol_dag_walk,$1,IMPL),$(\n)// impl: $(impl)$ \
  $(foreach header,$(strip $(patsubst $(abspath $(SRC_DIR))/%,%,
                 $(filter %.h,$(abspath $(SRCS-$(impl)))))),$ \
      $(\n)$(\h)include __impl_x($(header))))

#endif /* __MOD_HEADER__$(subst .,__,$1) */

endef

$(HEADERS_BUILD): $(EMBUILD_DUMP_PREREQUISITES) $(MK_DIR)/image.mk $(AUTOCONF_DIR)/mods.mk
	@$(MKDIR) $(@D) && printf "%b" '$(__header_gen)' > $@
