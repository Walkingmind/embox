/**
 * @file
 *
 * @date Dec 18, 2012
 * @author: Anton Bondarev
 */
#include <drivers/video/vga.h>
#include <drivers/video/vesa_mode.h>


static const unsigned char g_80x25_text[] = {
/* MISC */
	0x67,
/* SEQ */
	0x03, 0x00, 0x03, 0x00, 0x02,
/* CRTC */
	0x5F, 0x4F, 0x50, 0x82, 0x55, 0x81, 0xBF, 0x1F,
	0x00, 0x4F, 0x0D, 0x0E, 0x00, 0x00, 0x00, 0x50,
	0x9C, 0x0E, 0x8F, 0x28, 0x1F, 0x96, 0xB9, 0xA3,
	0xFF,
/* GC */
	0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x0E, 0x00,
	0xFF,
/* AC */
	0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x14, 0x07,
	0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F,
	0x0C, 0x00, 0x0F, 0x08, 0x00
};

extern void setup_font(unsigned font_height);

static void setup(struct vga_mode_description *vga_mode) {
	int cols, rows, ht, i;

	cols = 80;
	rows = 25;
	ht = 16;

	setup_font(8);

	/* tell the BIOS what we've done, so BIOS text output works OK */
	pokew(0x40, 0x4A, cols); /* columns on screen */
	pokew(0x40, 0x4C, cols * rows * 2); /* framebuffer size */
	pokew(0x40, 0x50, 0); /* cursor pos'n */
	pokeb(0x40, 0x60, ht - 1); /* cursor shape */
	pokeb(0x40, 0x61, ht - 2);
	pokeb(0x40, 0x84, rows - 1); /* rows on screen - 1 */
	pokeb(0x40, 0x85, ht); /* char height */
	/* set white-on-black attributes for all text */
	for (i = 0; i < cols * rows; i++) {
		pokeb(0xB800, i * 2 + 1, 7);
	}
}

VGA_MODE_DEFINE(0x3,g_80x25_text,NULL,NULL,setup,80,25);
