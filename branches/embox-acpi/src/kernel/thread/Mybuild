package embox.kernel.thread

@DefaultImpl(NoThreads)
abstract module thread_mode {

}

module NoThreads extends thread_mode {

}

module core extends thread_mode {
	option number thread_stack_size=8192
	option number thread_pool_size=16

	source "core.c"
	source "thread_allocator.c"
	source "idle_thread.c"
	source "boot_thread.c"

	@NoRuntime depends embox.kernel.sched.sched
	@NoRuntime depends embox.arch.context
	depends embox.kernel.task.kernel_task
	@NoRuntime depends embox.kernel.cpu.common
	depends embox.kernel.time.jiffies
	@NoRuntime depends embox.kernel.task.MultiThread
	@NoRuntime depends stack_api
	depends thread_local
	@NoRuntime depends thread_cancel
	//@NoRuntime depends embox.kernel.task.task_thread_key
	@NoRuntime depends signal
}

module signal {
	source "signal.c"
	@NoRuntime depends embox.kernel.thread.signal.sigstate_api
	depends embox.kernel.task.signal
}

@DefaultImpl(fixed_stack)
abstract module stack_api {
}


module fixed_stack extends stack_api {
	source "fixed_stack.c"
	source "fixed_stack.h"
}
@DefaultImpl(thread_local_heap)
abstract module thread_local {

}

module thread_local_none extends thread_local {
	source "thread_local_none.h"
}

module thread_local_heap extends thread_local {
	source "thread_local_heap.c"
	source "thread_local_heap.h"

	depends embox.mem.heap_api

	depends embox.kernel.task.task_thread_key
}
@DefaultImpl(thread_cancel_disable)
abstract module thread_cancel {}

module thread_cancel_enable extends thread_cancel {
	source "thread_cancel_enable.h"
	source "thread_cancel_enable.c"
	option number cleanups_quantity=100
}

module thread_cancel_disable extends thread_cancel {
	source "thread_cancel_disable.h"
}

/* FIXME: Deprecated */
module event {
	depends embox.kernel.event_api
}
