package third_party.phoneme

module core {
	depends embox.lib.LibC
	depends embox.lib.cxx.lib
}

@DefaultImpl(third_party.phoneme.cldc_standalone)
abstract module cldc {
	/*
	@InitFS
	@Generated(script="cat $(ROOT_DIR)/build/phoneme/build/amalgamated/bin/hello/dist/hello.jar")
	@Rule(prerequisites="$(ROOT_DIR)/build/phoneme/build/amalgamated/bin/hello/dist/hello.jar")
	source "hello.jar"
	*/
	
	source "core.c"
	
	@InitFS
	source "hello.jar" /* XXX bug in initfs. IT must be hello/hello.jar */

	depends third_party.phoneme.core // this is to build hello.jar
}

module cldc_standalone extends cldc {
	/*
	@IncludePath("$(ROOT_DIR)/build/phoneme/build/cldc/javacall_i386_gcc/dist/include")
	@IncludePath("$(ROOT_DIR)/build/phoneme/build/pcsl/javacall_i386/inc")
	@Rule(prerequisites="$(THIRDPARTY_DIR)/phoneme/...")
	source "cldc_standalone.c"
	*/
	
	@Rule(script="$(MAKE) -C $(THIRDPARTY_DIR)/phoneme MAKEFLAGS= ROOT_DIR=$(abspath $(ROOT_DIR)) EMBOX_CFLAGS='$(CFLAGS)' EMBOX_CXXFLAGS='$(CXXFLAGS)' EMBOX_CPPFLAGS='$(EMBOX_EXPORT_CPPFLAGS)'")
	source "../../../../phoneme/build/amalgamated/lib/phoneme_cldc.a"
	
    depends third_party.phoneme.core
}

module midp extends cldc {
	@Rule(script="$(MAKE) -C $(THIRDPARTY_DIR)/phoneme MAKEFLAGS= ROOT_DIR=$(abspath $(ROOT_DIR)) EMBOX_CFLAGS='$(CFLAGS)' EMBOX_CXXFLAGS='$(CXXFLAGS)' EMBOX_CPPFLAGS='$(EMBOX_EXPORT_CPPFLAGS)'")
	source "../../../../phoneme/build/amalgamated/lib/phoneme_midp.a"
	depends third_party.phoneme.core
}

module javacall {
	depends third_party.phoneme.core
	depends embox.compat.posix.fs.file
}
